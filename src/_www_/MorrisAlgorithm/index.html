<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>How to traverse a binary tree without using any stack</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="how-to-traverse-a-binary-tree-without-using-any-stack">
<h1 class="title">How to traverse a binary tree without using any stack</h1>

<p>There is an exercise (ex.2.3.1-21) in <a class="reference external" href="http://www-cs-faculty.stanford.edu/~uno/taocp.html">TAOCP</a> vol.1:</p>
<blockquote>
21. [33] Design an algorithm that traverses an unthreaded binary tree in inorder <em>without using any auxiliary stack</em>.
It is permissible to alter the <tt class="docutils literal">LLINK</tt> and <tt class="docutils literal">RLINK</tt> fields of the tree nodes in ny manner whatsoever during the traversal, subject only to the
condition that the binary tree should have the conventional representation illustrated in (2) both before and after your algorithm has traversed the tree.
No other bits in the tree nodes are available for temporary storage.</blockquote>
<div class="figure">
<img alt="TAOCP 2.3.1-(2)" src="TAOCP-2.3.1-(2).png" />
<p class="caption">(from TAOCP 2.3.1)</p>
</div>
<p>In the answer given by Prof. Knuth, an algorithm by Joseph M. Morris [<em>Inf. Proc. Letters</em> <strong>9</strong> (1979), 197-200] is introduced.
The algorithm is very interesting. I'd like to show you how it works here.</p>
<div class="section" id="inorder-traversal-using-a-stack">
<h1>Inorder traversal using a stack</h1>
<p>First let's see how to do an inorder traversal using a stack:</p>
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre style="line-height: 125%"><span style="color: #B00040">void</span> <span style="color: #0000FF">inorder_traverse</span>(NODE <span style="color: #666666">*</span> T)
{
        NODE <span style="color: #666666">*</span> p <span style="color: #666666">=</span> T;
        <span style="color: #008000; font-weight: bold">while</span> (<span style="color: #666666">1</span>) {
                <span style="color: #008000; font-weight: bold">while</span> (p) {
                        PUSH(p);
                        p <span style="color: #666666">=</span> p<span style="color: #666666">-&gt;</span>L;
                }
                <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>(p <span style="color: #666666">=</span> POP()))
                        <span style="color: #008000; font-weight: bold">break</span>;
                visit(p);
                p <span style="color: #666666">=</span> p<span style="color: #666666">-&gt;</span>R;
        }
}
</pre></div>
</td></tr></table><p>This function can be illustrated as:</p>
<div class="figure">
<img alt="inorder traversal using a stack" src="inorder.png" />
</div>
<ul class="simple">
<li><tt class="docutils literal">p</tt> is the <em>current</em> node</li>
<li>if the current is not <tt class="docutils literal">NULL</tt>, we <tt class="docutils literal">push</tt> it and move left</li>
<li>if the current is <tt class="docutils literal">NULL</tt>, we <tt class="docutils literal">pop</tt> a node up, <tt class="docutils literal">visit</tt> it and move right</li>
<li>every time we move, either move left or move right, we start a new loop (just like recursion)</li>
</ul>
<p>The key points are:</p>
<ul class="simple">
<li>we move left after <tt class="docutils literal">push</tt>ing a node, so that we will <tt class="docutils literal">pop</tt> and <tt class="docutils literal">visit</tt> nodes from left to right</li>
<li>we move right after <tt class="docutils literal">pop</tt>ing and <tt class="docutils literal">visit</tt>ing a node, because the left subtree must have been manipulated</li>
</ul>
<p>Function <tt class="docutils literal">inorder_traverse</tt> is not hard to understand. You should have known well about it.
Now let's see how Morris modified it so that no stack is needed any more.</p>
</div>
<div class="section" id="morris-algorithm">
<h1>Morris Algorithm</h1>
<p>The following is the pseudo-C code of Morris Algorithm:</p>
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><a href="#code-inorder-morris-1"> 1</a>
<a href="#code-inorder-morris-2"> 2</a>
<a href="#code-inorder-morris-3"> 3</a>
<a href="#code-inorder-morris-4"> 4</a>
<a href="#code-inorder-morris-5"> 5</a>
<a href="#code-inorder-morris-6"> 6</a>
<a href="#code-inorder-morris-7"> 7</a>
<a href="#code-inorder-morris-8"> 8</a>
<a href="#code-inorder-morris-9"> 9</a>
<a href="#code-inorder-morris-10">10</a>
<a href="#code-inorder-morris-11">11</a>
<a href="#code-inorder-morris-12">12</a>
<a href="#code-inorder-morris-13">13</a>
<a href="#code-inorder-morris-14">14</a>
<a href="#code-inorder-morris-15">15</a>
<a href="#code-inorder-morris-16">16</a></pre></div></td><td class="code"><div class="highlight"><pre style="line-height: 125%"><a name="code-inorder-morris-1"></a><span style="color: #B00040">void</span> <span style="color: #0000FF">inorder_Morris</span>(NODE <span style="color: #666666">*</span> T)
<a name="code-inorder-morris-2"></a>{
<a name="code-inorder-morris-3"></a>        NODE <span style="color: #666666">*</span> p <span style="color: #666666">=</span> T;
<a name="code-inorder-morris-4"></a>        <span style="color: #008000; font-weight: bold">while</span> (p) {
<a name="code-inorder-morris-5"></a>                <span style="color: #008000; font-weight: bold">while</span> (p<span style="color: #666666">-&gt;</span>L) {
<a name="code-inorder-morris-6"></a>                        <span style="color: #408080; font-style: italic">/** insert or remove thread **/</span>
<a name="code-inorder-morris-7"></a>                        <span style="color: #008000; font-weight: bold">if</span> (no_thread)
<a name="code-inorder-morris-8"></a>                                insert_thread;
<a name="code-inorder-morris-9"></a>                        <span style="color: #008000; font-weight: bold">else</span>
<a name="code-inorder-morris-10"></a>                                remove_thread;
<a name="code-inorder-morris-11"></a>                        p <span style="color: #666666">=</span> p<span style="color: #666666">-&gt;</span>L;
<a name="code-inorder-morris-12"></a>                }
<a name="code-inorder-morris-13"></a>                visit(p);
<a name="code-inorder-morris-14"></a>                p <span style="color: #666666">=</span> p<span style="color: #666666">-&gt;</span>R;
<a name="code-inorder-morris-15"></a>        }
<a name="code-inorder-morris-16"></a>}
</pre></div>
</td></tr></table><p>The key point is to transform the binary tree into a <em>right-threaded binary tree</em> temporarily and restore it later (line <a class="reference external" href="#code-inorder-morris-7">7</a>, <a class="reference external" href="#code-inorder-morris-8">8</a>, <a class="reference external" href="#code-inorder-morris-9">9</a>, <a class="reference external" href="#code-inorder-morris-10">10</a>).</p>
<p>A right-threaded binary tree, if you never heard of it, is a binary tree like this:</p>
<div class="figure">
<img alt="inorder Morris" src="right-threaded-bintree.png" />
<p class="caption">Right-threaded binary tree</p>
</div>
<p>As this figure shows, the <tt class="docutils literal">NULL</tt> right child of a node <tt class="docutils literal">P</tt> is used to point to <tt class="docutils literal">P</tt>'s inorder successor (denoted as <tt class="docutils literal">P$</tt>).
That is to say:</p>
<ol class="arabic simple">
<li>The right link of any node without a right child will be used as the start of a thread (dotted lines)</li>
<li>If a node <tt class="docutils literal">P</tt> has a left subtree, then <tt class="docutils literal">P</tt> is the end of a thread whose start point is <tt class="docutils literal">$P</tt> (<tt class="docutils literal">P</tt>'s inorder predecessor).
Therefore, we can add this thread (from <tt class="docutils literal">$P</tt> to <tt class="docutils literal">P</tt>) when reaching <tt class="docutils literal">P</tt> and remove it after coming back to <tt class="docutils literal">P</tt> from <tt class="docutils literal">$P</tt>.</li>
</ol>
<p>Let's study figure <em>Right-threaded binary tree</em>, which is transformed from (2).
There are 4 nodes that have left subtrees: <tt class="docutils literal">A</tt>, <tt class="docutils literal">B</tt>, <tt class="docutils literal">C</tt> and <tt class="docutils literal">F</tt>, so there are 4 thread that point to them.
The key point is that the nodes pointing to them are their inorder predecessors respectively: <tt class="docutils literal">B</tt>, <tt class="docutils literal">D</tt>, <tt class="docutils literal">G</tt> and <tt class="docutils literal">H</tt>.
Therefore, we do not need to push <tt class="docutils literal">A</tt>, <tt class="docutils literal">B</tt>, <tt class="docutils literal">C</tt> and <tt class="docutils literal">F</tt> into stack, since we can reach them via the right links of their inorder predecessors.</p>
<p>This is the main idea of Morris algorithm. Now let's rewrite our <tt class="docutils literal">inorder_traverse</tt> so that it looks more like <tt class="docutils literal">inorder_Morris</tt>:</p>
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><a href="#code-inorder-traverse-variant-1"> 1</a>
<a href="#code-inorder-traverse-variant-2"> 2</a>
<a href="#code-inorder-traverse-variant-3"> 3</a>
<a href="#code-inorder-traverse-variant-4"> 4</a>
<a href="#code-inorder-traverse-variant-5"> 5</a>
<a href="#code-inorder-traverse-variant-6"> 6</a>
<a href="#code-inorder-traverse-variant-7"> 7</a>
<a href="#code-inorder-traverse-variant-8"> 8</a>
<a href="#code-inorder-traverse-variant-9"> 9</a>
<a href="#code-inorder-traverse-variant-10">10</a>
<a href="#code-inorder-traverse-variant-11">11</a>
<a href="#code-inorder-traverse-variant-12">12</a>
<a href="#code-inorder-traverse-variant-13">13</a>
<a href="#code-inorder-traverse-variant-14">14</a>
<a href="#code-inorder-traverse-variant-15">15</a>
<a href="#code-inorder-traverse-variant-16">16</a>
<a href="#code-inorder-traverse-variant-17">17</a>
<a href="#code-inorder-traverse-variant-18">18</a>
<a href="#code-inorder-traverse-variant-19">19</a>
<a href="#code-inorder-traverse-variant-20">20</a></pre></div></td><td class="code"><div class="highlight"><pre style="line-height: 125%"><a name="code-inorder-traverse-variant-1"></a><span style="color: #B00040">void</span> <span style="color: #0000FF">inorder_traverse</span>(NODE <span style="color: #666666">*</span> T)
<a name="code-inorder-traverse-variant-2"></a>{
<a name="code-inorder-traverse-variant-3"></a>        NODE <span style="color: #666666">*</span> p <span style="color: #666666">=</span> T;
<a name="code-inorder-traverse-variant-4"></a>        <span style="color: #008000; font-weight: bold">while</span> (p) {
<a name="code-inorder-traverse-variant-5"></a>                <span style="color: #008000; font-weight: bold">while</span> (p<span style="color: #666666">-&gt;</span>L) {
<a name="code-inorder-traverse-variant-6"></a>                        <span style="color: #008000; font-weight: bold">if</span> (p <span style="color: #666666">!=</span> STACK_TOP()) {
<a name="code-inorder-traverse-variant-7"></a>                                PUSH(p);
<a name="code-inorder-traverse-variant-8"></a>                        } <span style="color: #008000; font-weight: bold">else</span> {
<a name="code-inorder-traverse-variant-9"></a>                                p <span style="color: #666666">=</span> POP();
<a name="code-inorder-traverse-variant-10"></a>                                <span style="color: #008000; font-weight: bold">break</span>;
<a name="code-inorder-traverse-variant-11"></a>                        }
<a name="code-inorder-traverse-variant-12"></a>                        p <span style="color: #666666">=</span> p<span style="color: #666666">-&gt;</span>L;
<a name="code-inorder-traverse-variant-13"></a>                }
<a name="code-inorder-traverse-variant-14"></a>                visit(p);
<a name="code-inorder-traverse-variant-15"></a>                <span style="color: #008000; font-weight: bold">if</span> (p<span style="color: #666666">-&gt;</span>R)
<a name="code-inorder-traverse-variant-16"></a>                        p <span style="color: #666666">=</span> p<span style="color: #666666">-&gt;</span>R;
<a name="code-inorder-traverse-variant-17"></a>                <span style="color: #008000; font-weight: bold">else</span>
<a name="code-inorder-traverse-variant-18"></a>                        p <span style="color: #666666">=</span> STACK_TOP(); <span style="color: #408080; font-style: italic">/* note: STACK[BASE] == 0 */</span>
<a name="code-inorder-traverse-variant-19"></a>        }
<a name="code-inorder-traverse-variant-20"></a>}
</pre></div>
</td></tr></table><p>This is a <em>disguised</em> <tt class="docutils literal">inorder_traverse</tt>.
It does the same thing as the first <tt class="docutils literal">inorder_traverse</tt>, but it looks very similar with <tt class="docutils literal">inorder_Morris</tt> so we only need to do very slight modification and an
implementation of Morris algorithm will be done.</p>
<p>Before implementing the Morris algorithm, let's imagine all threads are inserted into the tree. It's easy to know:</p>
<ul>
<li><p class="first">line <a class="reference external" href="#code-inorder-traverse-variant-15">15</a> is always true (except that we have reached the last node)</p>
</li>
<li><p class="first">if the line from <tt class="docutils literal">p</tt> to <tt class="docutils literal"><span class="pre">p-&gt;R</span></tt> is a thread, then <tt class="docutils literal"><span class="pre">p-&gt;R</span></tt> always points to the stack top, so we no more need a stack</p>
</li>
<li><p class="first">to implement Morris algorithm, we only need to replace line <a class="reference external" href="#code-inorder-traverse-variant-7">7</a> and <a class="reference external" href="#code-inorder-traverse-variant-9">9</a> with <tt class="docutils literal">insert_thread</tt> code and <tt class="docutils literal">remove_thread</tt> code respectively and we're done</p>
</li>
<li><dl class="first docutils">
<dt>after threads are inserted into the tree, there are circles so we can always come back through the right links, so:</dt>
<dd><ul class="first last">
<li><p class="first">if a node has no left subtree, <tt class="docutils literal">visit</tt> it without <tt class="docutils literal">push</tt>ing or <tt class="docutils literal">pop</tt>ing</p>
</li>
<li><dl class="first docutils">
<dt>if a node has a left subtree, do <em>normal</em> inorder traversal, except that:</dt>
<dd><ul class="first last simple">
<li>insert right thread when <tt class="docutils literal">push</tt> is needed</li>
<li>remove right thread when we come back (i.e. when <tt class="docutils literal">pop</tt> is needed)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>I guess you have understood Morris algorithm well, it's time to code it:</p>
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><a href="#code-morris-algorithm-1"> 1</a>
<a href="#code-morris-algorithm-2"> 2</a>
<a href="#code-morris-algorithm-3"> 3</a>
<a href="#code-morris-algorithm-4"> 4</a>
<a href="#code-morris-algorithm-5"> 5</a>
<a href="#code-morris-algorithm-6"> 6</a>
<a href="#code-morris-algorithm-7"> 7</a>
<a href="#code-morris-algorithm-8"> 8</a>
<a href="#code-morris-algorithm-9"> 9</a>
<a href="#code-morris-algorithm-10">10</a>
<a href="#code-morris-algorithm-11">11</a>
<a href="#code-morris-algorithm-12">12</a>
<a href="#code-morris-algorithm-13">13</a>
<a href="#code-morris-algorithm-14">14</a>
<a href="#code-morris-algorithm-15">15</a>
<a href="#code-morris-algorithm-16">16</a>
<a href="#code-morris-algorithm-17">17</a>
<a href="#code-morris-algorithm-18">18</a>
<a href="#code-morris-algorithm-19">19</a>
<a href="#code-morris-algorithm-20">20</a>
<a href="#code-morris-algorithm-21">21</a>
<a href="#code-morris-algorithm-22">22</a>
<a href="#code-morris-algorithm-23">23</a>
<a href="#code-morris-algorithm-24">24</a>
<a href="#code-morris-algorithm-25">25</a>
<a href="#code-morris-algorithm-26">26</a>
<a href="#code-morris-algorithm-27">27</a>
<a href="#code-morris-algorithm-28">28</a>
<a href="#code-morris-algorithm-29">29</a>
<a href="#code-morris-algorithm-30">30</a>
<a href="#code-morris-algorithm-31">31</a>
<a href="#code-morris-algorithm-32">32</a>
<a href="#code-morris-algorithm-33">33</a>
<a href="#code-morris-algorithm-34">34</a>
<a href="#code-morris-algorithm-35">35</a>
<a href="#code-morris-algorithm-36">36</a>
<a href="#code-morris-algorithm-37">37</a>
<a href="#code-morris-algorithm-38">38</a>
<a href="#code-morris-algorithm-39">39</a>
<a href="#code-morris-algorithm-40">40</a>
<a href="#code-morris-algorithm-41">41</a>
<a href="#code-morris-algorithm-42">42</a>
<a href="#code-morris-algorithm-43">43</a>
<a href="#code-morris-algorithm-44">44</a>
<a href="#code-morris-algorithm-45">45</a></pre></div></td><td class="code"><div class="highlight"><pre style="line-height: 125%"><a name="code-morris-algorithm-1"></a><span style="color: #B00040">void</span> <span style="color: #0000FF">Joseph_M_Morris</span>(<span style="color: #008000; font-weight: bold">struct</span> node <span style="color: #666666">*</span> T)
<a name="code-morris-algorithm-2"></a>{
<a name="code-morris-algorithm-3"></a>        <span style="color: #408080; font-style: italic">/* U1. [Initialize.] */</span>
<a name="code-morris-algorithm-4"></a>        P <span style="color: #666666">=</span> T;
<a name="code-morris-algorithm-5"></a>        R <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<a name="code-morris-algorithm-6"></a>
<a name="code-morris-algorithm-7"></a>        <span style="color: #008000; font-weight: bold">while</span> (P) { <span style="color: #408080; font-style: italic">/* U2. [Done?] */</span>
<a name="code-morris-algorithm-8"></a>                <span style="color: #008000; font-weight: bold">while</span> (<span style="color: #666666">1</span>) {
<a name="code-morris-algorithm-9"></a>                        <span style="color: #408080; font-style: italic">/* U3. [Look left.] */</span>
<a name="code-morris-algorithm-10"></a>                        Q <span style="color: #666666">=</span> P<span style="color: #666666">-&gt;</span>L;
<a name="code-morris-algorithm-11"></a>                        <span style="color: #008000; font-weight: bold">if</span> (Q <span style="color: #666666">==</span> <span style="color: #666666">0</span>) {
<a name="code-morris-algorithm-12"></a>                                visit(P, preorder);
<a name="code-morris-algorithm-13"></a>                                <span style="color: #008000; font-weight: bold">break</span>; <span style="color: #408080; font-style: italic">/* goto U6; */</span>
<a name="code-morris-algorithm-14"></a>                        }
<a name="code-morris-algorithm-15"></a>
<a name="code-morris-algorithm-16"></a>                        <span style="color: #408080; font-style: italic">/* U4. [Search for thread.] */</span>
<a name="code-morris-algorithm-17"></a>                        <span style="color: #008000; font-weight: bold">while</span> (Q <span style="color: #666666">!=</span> R <span style="color: #666666">&amp;&amp;</span> Q<span style="color: #666666">-&gt;</span>R <span style="color: #666666">!=</span> <span style="color: #666666">0</span>)
<a name="code-morris-algorithm-18"></a>                                Q <span style="color: #666666">=</span> Q<span style="color: #666666">-&gt;</span>R;
<a name="code-morris-algorithm-19"></a>                        assert(Q <span style="color: #666666">==</span> R <span style="color: #666666">||</span> Q<span style="color: #666666">-&gt;</span>R <span style="color: #666666">==</span> <span style="color: #666666">0</span>);
<a name="code-morris-algorithm-20"></a>
<a name="code-morris-algorithm-21"></a>                        <span style="color: #408080; font-style: italic">/* U5. [Insert or remove thread.] */</span>
<a name="code-morris-algorithm-22"></a>                        <span style="color: #008000; font-weight: bold">if</span> (Q <span style="color: #666666">!=</span> R) {
<a name="code-morris-algorithm-23"></a>                                Q<span style="color: #666666">-&gt;</span>R <span style="color: #666666">=</span> P;
<a name="code-morris-algorithm-24"></a>                        } <span style="color: #008000; font-weight: bold">else</span> {
<a name="code-morris-algorithm-25"></a>                                Q<span style="color: #666666">-&gt;</span>R <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<a name="code-morris-algorithm-26"></a>                                <span style="color: #008000; font-weight: bold">break</span>;
<a name="code-morris-algorithm-27"></a>                        }
<a name="code-morris-algorithm-28"></a>
<a name="code-morris-algorithm-29"></a>                        <span style="color: #408080; font-style: italic">/* U8. [Preorder visit.] */</span>
<a name="code-morris-algorithm-30"></a>                        visit(P, preorder);
<a name="code-morris-algorithm-31"></a>
<a name="code-morris-algorithm-32"></a>                        <span style="color: #408080; font-style: italic">/* U9. [Go to left.] */</span>
<a name="code-morris-algorithm-33"></a>                        P <span style="color: #666666">=</span> P<span style="color: #666666">-&gt;</span>L;
<a name="code-morris-algorithm-34"></a>                        <span style="color: #408080; font-style: italic">/* goto U3 */</span>
<a name="code-morris-algorithm-35"></a>                }
<a name="code-morris-algorithm-36"></a>
<a name="code-morris-algorithm-37"></a>                <span style="color: #408080; font-style: italic">/* U6. [Inorder visit.] */</span>
<a name="code-morris-algorithm-38"></a>                visit(P, inorder);
<a name="code-morris-algorithm-39"></a>
<a name="code-morris-algorithm-40"></a>                <span style="color: #408080; font-style: italic">/* U7. [Go to right or up.] */</span>
<a name="code-morris-algorithm-41"></a>                R <span style="color: #666666">=</span> P;
<a name="code-morris-algorithm-42"></a>                P <span style="color: #666666">=</span> P<span style="color: #666666">-&gt;</span>R;
<a name="code-morris-algorithm-43"></a>                <span style="color: #408080; font-style: italic">/* goto U2 */</span>
<a name="code-morris-algorithm-44"></a>        }
<a name="code-morris-algorithm-45"></a>}
</pre></div>
</td></tr></table><p>The code implements not only inorder traversal but also preorder traversal. It is not hard with the help of right threads.
The key parts are U4, U5 and line <a class="reference external" href="#code-morris-algorithm-41">41</a>.</p>
<p>I made a slides showing how this algorithm works. Please click <a class="reference external" href="#../morris-algorithm/">here</a> (it contains many figures, you may have to wait a while when it's loading).</p>
</div>
</div>
</body>
</html>
